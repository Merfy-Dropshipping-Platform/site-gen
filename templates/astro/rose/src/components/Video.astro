---
interface Props {
  video?: { url?: string; coverImage?: string };
  position?: 'fullscreen' | 'window';
  content?: {
    size?: 'small' | 'medium' | 'large';
    heading?: { enabled?: string; text?: string; size?: string };
    subheading?: { enabled?: string; text?: string };
  };
  colorScheme?: string;
  padding?: { top?: number; bottom?: number };
}

const { video, position = 'window', content, padding } = Astro.props;
const videoUrl = video?.url ?? '';
const coverImage = video?.coverImage ?? '';
const showHeading = content?.heading?.enabled !== 'false' && content?.heading?.text;
const showSubheading = content?.subheading?.enabled !== 'false' && content?.subheading?.text;
const contentSize = content?.size ?? 'medium';
const padTop = padding?.top ?? 80;
const padBottom = padding?.bottom ?? 80;

// Extract YouTube/Vimeo embed URL
function getEmbedUrl(url: string): string {
  if (!url) return '';
  const ytMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/);
  if (ytMatch) return `https://www.youtube.com/embed/${ytMatch[1]}`;
  const vimeoMatch = url.match(/vimeo\.com\/(\d+)/);
  if (vimeoMatch) return `https://player.vimeo.com/video/${vimeoMatch[1]}`;
  return url;
}

const embedUrl = getEmbedUrl(videoUrl);

const isFullscreen = position === 'fullscreen';

const headingSizeClasses: Record<string, string> = {
  small: 'text-2xl',
  medium: 'text-[2rem]',
  large: 'text-[2.5rem]',
};
const headingSizeClass = headingSizeClasses[contentSize] || headingSizeClasses.medium;
---

<section
  class={isFullscreen ? 'w-full' : 'max-w-[1200px] mx-auto px-5'}
  style={`padding-top: ${padTop}px; padding-bottom: ${padBottom}px;`}
>
  <div>
    {(showHeading || showSubheading) && (
      <div class="text-center mb-10 max-w-[700px] mx-auto">
        {showHeading && (
          <h2 class={`${headingSizeClass} font-medium text-gray-900 mb-3 leading-[1.2] font-comfortaa`}>
            {content!.heading!.text}
          </h2>
        )}
        {showSubheading && (
          <p class="text-[1.1rem] text-gray-600 leading-[1.6] font-manrope">
            {content!.subheading!.text}
          </p>
        )}
      </div>
    )}
    <div class={`relative aspect-video overflow-hidden bg-gray-900 ${isFullscreen ? 'rounded-none' : 'rounded-2xl'}`}>
      {embedUrl ? (
        <iframe
          src={embedUrl}
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          loading="lazy"
          class="w-full h-full"
        ></iframe>
      ) : coverImage ? (
        <img src={coverImage} alt="Video cover" class="w-full h-full object-cover" loading="lazy" />
      ) : (
        <div class="w-full h-full flex items-center justify-center text-gray-500">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <polygon points="5,3 19,12 5,21"/>
          </svg>
        </div>
      )}
    </div>
  </div>
</section>
