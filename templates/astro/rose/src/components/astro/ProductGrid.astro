---
/**
 * ProductGrid.astro -- Static SSG fallback.
 *
 * Reads products from ../data/products.json at build time and renders a grid.
 * At runtime, the React Island version (react/ProductGrid.tsx) takes over with
 * interactive filtering/sorting via client:load.
 */
import ProductCard from './ProductCard.astro';
import SectionHeader from '../shared/SectionHeader.astro';

interface Product {
  id?: string;
  handle?: string;
  title?: string;
  name?: string;
  price?: number | string;
  compareAtPrice?: number;
  oldPrice?: string;
  images?: Array<{ url: string; alt?: string }>;
  image?: string;
}

interface Props {
  title?: string;
  columns?: number;
  limit?: number;
  collectionId?: string;
}

const {
  title = 'Каталог',
  columns = 4,
  limit = 24,
} = Astro.props;

let products: Product[] = [];
try {
  const productsData = await import('../../data/products.json');
  const rawProducts = productsData.default || [];
  products = rawProducts.slice(0, limit);
} catch {
  // Fallback: empty — will show "coming soon" message
  products = [];
}
---

<section class="w-full py-10 sm:py-14 md:py-20">
  <div class="w-full max-w-[1920px] mx-auto px-4 sm:px-6 md:px-8 lg:px-12 xl:px-16">
    {title && <SectionHeader title={title} />}

    {products.length === 0 ? (
      <p class="text-center text-gray-500 text-lg py-12">Товары скоро появятся</p>
    ) : (
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-5 md:gap-6 product-grid-responsive">
        {products.map((product) => (
          <ProductCard
            id={product.id}
            handle={product.handle}
            title={product.title ?? product.name}
            price={product.price}
            compareAtPrice={product.compareAtPrice}
            oldPrice={product.oldPrice}
            images={product.images}
            image={product.image}
          />
        ))}
      </div>
    )}
  </div>
</section>

<style define:vars={{ cols: columns }}>
  @media (min-width: 1024px) {
    .product-grid-responsive {
      grid-template-columns: repeat(var(--cols), 1fr);
    }
  }
</style>
