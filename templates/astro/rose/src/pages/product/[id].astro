---
import data from '../../data/data.json';
import products from '../../data/products.json';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

export function getStaticPaths() {
  const productList = products || [];
  return productList.map((product: any) => ({
    params: { id: product.slug ?? product.id },
    props: { product },
  }));
}

const { product } = Astro.props;
const meta = data?.meta ?? {};

function formatPrice(price: number): string {
  return new Intl.NumberFormat('ru-RU', {
    style: 'currency',
    currency: 'RUB',
    minimumFractionDigits: 0,
  }).format(price);
}
---
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{product?.name ?? 'Товар'} — {meta?.title ?? 'Мой магазин'}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
      :root {
        --rose-50: #fff1f2;
        --rose-100: #ffe4e6;
        --rose-200: #fecdd3;
        --rose-300: #fda4af;
        --rose-400: #fb7185;
        --rose-500: #f43f5e;
        --rose-600: #e11d48;
        --rose-700: #be123c;
        --rose-800: #9f1239;
        --rose-900: #881337;

        --neutral-50: #fafafa;
        --neutral-100: #f5f5f5;
        --neutral-200: #e5e5e5;
        --neutral-300: #d4d4d4;
        --neutral-400: #a3a3a3;
        --neutral-500: #737373;
        --neutral-600: #525252;
        --neutral-700: #404040;
        --neutral-800: #262626;
        --neutral-900: #171717;

        --font-display: 'Cormorant Garamond', Georgia, serif;
        --font-body: 'Inter', system-ui, -apple-system, sans-serif;
      }

      * { box-sizing: border-box; margin: 0; padding: 0; }

      body {
        font-family: var(--font-body);
        color: var(--neutral-800);
        background: var(--neutral-50);
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      main {
        flex: 1;
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px 80px;
        width: 100%;
      }

      h1, h2, h3 {
        font-family: var(--font-display);
        font-weight: 500;
        letter-spacing: -0.02em;
      }

      a {
        color: var(--rose-600);
        text-decoration: none;
        transition: color 0.2s;
      }

      a:hover {
        color: var(--rose-700);
      }

      .breadcrumb {
        margin-bottom: 32px;
        font-size: 0.9rem;
        color: var(--neutral-500);
      }

      .breadcrumb a {
        color: var(--neutral-500);
      }

      .breadcrumb a:hover {
        color: var(--rose-600);
      }

      .product-page {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 60px;
      }

      @media (max-width: 768px) {
        .product-page {
          grid-template-columns: 1fr;
          gap: 32px;
        }
      }

      .product-gallery {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .product-main-image {
        aspect-ratio: 3/4;
        background: var(--rose-50);
        border-radius: 16px;
        overflow: hidden;
      }

      .product-main-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .product-main-image-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--rose-300);
      }

      .product-details {
        padding-top: 20px;
      }

      .product-title {
        font-size: 2.5rem;
        color: var(--neutral-900);
        margin-bottom: 16px;
        line-height: 1.2;
      }

      .product-price {
        font-size: 1.75rem;
        font-weight: 600;
        color: var(--rose-600);
        margin-bottom: 24px;
      }

      .product-description {
        font-size: 1rem;
        color: var(--neutral-600);
        line-height: 1.7;
        margin-bottom: 32px;
      }

      .add-to-cart {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 16px 48px;
        font-size: 1rem;
        font-weight: 500;
        background: var(--rose-600);
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .add-to-cart:hover {
        background: var(--rose-700);
      }
    </style>
  </head>
  <body>
    <Header siteName={meta?.title ?? 'ROSE'} />

    <main>
      <p class="breadcrumb">
        <a href="/">Главная</a> / <a href="/catalog">Каталог</a> / {product?.name}
      </p>

      <div class="product-page">
        <div class="product-gallery">
          <div class="product-main-image">
            {product?.images && product.images[0] ? (
              <img src={product.images[0]} alt={product.name} />
            ) : (
              <div class="product-main-image-placeholder">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                  <circle cx="8.5" cy="8.5" r="1.5"/>
                  <polyline points="21,15 16,10 5,21"/>
                </svg>
              </div>
            )}
          </div>
        </div>

        <div class="product-details">
          <h1 class="product-title">{product?.name}</h1>
          <div class="product-price">{formatPrice(product?.price ?? 0)}</div>
          {product?.description && (
            <p class="product-description">{product.description}</p>
          )}
          <a href={`/checkout?productId=${product.slug ?? product.id}`} class="add-to-cart">Купить сейчас</a>
        </div>
      </div>
    </main>

    <Footer siteName={meta?.title ?? 'ROSE'} />
  </body>
</html>
