---
interface Post {
  image?: string;
  title?: string;
  description?: string;
  link?: { enabled?: string; text?: string; href?: string };
  hidden?: boolean;
}

interface Props {
  heading?: { enabled?: string; text?: string; size?: 'small' | 'medium' | 'large' };
  posts?: Post[];
  columnsCount?: number;
  dateTime?: { enabled?: string };
  colorScheme?: string;
  padding?: { top?: number; bottom?: number };
}

const { heading, posts = [], columnsCount = 3, padding } = Astro.props;
const showHeading = heading?.enabled !== 'false' && heading?.text;
const headingSize = heading?.size ?? 'medium';
const padTop = padding?.top ?? 80;
const padBottom = padding?.bottom ?? 80;
const visiblePosts = posts.filter((p) => !p.hidden);

const headingSizeClass: Record<string, string> = {
  small: 'text-2xl',
  medium: 'text-[2rem]',
  large: 'text-[2.5rem]',
};

const cols = columnsCount;
---

<section class="max-w-[1200px] mx-auto px-5" style={`padding-top: ${padTop}px; padding-bottom: ${padBottom}px;`}>
  <div>
    {showHeading && (
      <h2 class={`font-comfortaa font-medium text-gray-900 text-center mb-12 leading-[1.2] ${headingSizeClass[headingSize] ?? 'text-[2rem]'}`}>
        {heading!.text}
      </h2>
    )}

    {visiblePosts.length === 0 ? (
      <p class="text-center text-gray-500 text-lg py-10">Публикации скоро появятся</p>
    ) : (
      <div class="grid publications-grid gap-8 max-md:!grid-cols-2 max-md:gap-6 max-[480px]:!grid-cols-1">
        {visiblePosts.map((post) => (
          <article class="bg-white rounded-2xl overflow-hidden transition-all duration-300 hover:-translate-y-1 hover:shadow-[0_16px_32px_rgba(0,0,0,0.08)] group">
            {post.image && (
              <div class="aspect-video overflow-hidden bg-gray-50">
                <img
                  src={post.image}
                  alt={post.title ?? ''}
                  loading="lazy"
                  class="w-full h-full object-cover transition-transform duration-400 group-hover:scale-105"
                />
              </div>
            )}
            <div class="p-5">
              {post.title && (
                <h3 class="font-comfortaa text-[1.15rem] font-medium text-gray-900 mb-2 leading-[1.3]">{post.title}</h3>
              )}
              {post.description && (
                <p class="text-[0.95rem] text-gray-600 leading-relaxed mb-3">{post.description}</p>
              )}
              {post.link?.enabled !== 'false' && post.link?.href && (
                <a href={post.link.href} class="text-sm font-medium text-black no-underline transition-colors duration-200 hover:text-gray-800">
                  {post.link.text ?? 'Читать далее'}
                </a>
              )}
            </div>
          </article>
        ))}
      </div>
    )}
  </div>
</section>

<style define:vars={{ cols }}>
  .publications-grid {
    grid-template-columns: repeat(var(--cols), 1fr);
  }
</style>
