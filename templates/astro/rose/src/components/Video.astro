---
interface Props {
  video?: { url?: string; coverImage?: string };
  position?: 'fullscreen' | 'window';
  content?: {
    size?: 'small' | 'medium' | 'large';
    heading?: { enabled?: string; text?: string; size?: string };
    subheading?: { enabled?: string; text?: string };
  };
  colorScheme?: string;
  padding?: { top?: number; bottom?: number };
}

const { video, position = 'window', content, padding } = Astro.props;
const videoUrl = video?.url ?? '';
const coverImage = video?.coverImage ?? '';
const showHeading = content?.heading?.enabled !== 'false' && content?.heading?.text;
const showSubheading = content?.subheading?.enabled !== 'false' && content?.subheading?.text;
const contentSize = content?.size ?? 'medium';
const padTop = padding?.top ?? 80;
const padBottom = padding?.bottom ?? 80;

// Extract YouTube/Vimeo embed URL
function getEmbedUrl(url: string): string {
  if (!url) return '';
  const ytMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/);
  if (ytMatch) return `https://www.youtube.com/embed/${ytMatch[1]}`;
  const vimeoMatch = url.match(/vimeo\.com\/(\d+)/);
  if (vimeoMatch) return `https://player.vimeo.com/video/${vimeoMatch[1]}`;
  return url;
}

const embedUrl = getEmbedUrl(videoUrl);
---

<section class={`video-section video-section--${contentSize} video-section--${position}`} style={`padding-top: ${padTop}px; padding-bottom: ${padBottom}px;`}>
  <div class="video-container">
    {(showHeading || showSubheading) && (
      <div class="video-text">
        {showHeading && <h2 class="video-heading">{content!.heading!.text}</h2>}
        {showSubheading && <p class="video-subheading">{content!.subheading!.text}</p>}
      </div>
    )}
    <div class="video-wrapper">
      {embedUrl ? (
        <iframe
          src={embedUrl}
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          loading="lazy"
          class="video-iframe"
        ></iframe>
      ) : coverImage ? (
        <img src={coverImage} alt="Video cover" class="video-cover" loading="lazy" />
      ) : (
        <div class="video-placeholder">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <polygon points="5,3 19,12 5,21"/>
          </svg>
        </div>
      )}
    </div>
  </div>
</section>

<style>
  .video-section {
    max-width: 1200px;
    margin: 0 auto;
    padding-left: 20px;
    padding-right: 20px;
  }

  .video-section--fullscreen {
    max-width: 100%;
    padding-left: 0;
    padding-right: 0;
  }

  .video-text {
    text-align: center;
    margin-bottom: 40px;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
  }

  .video-heading {
    font-family: var(--font-display);
    font-weight: 500;
    color: var(--neutral-900);
    margin-bottom: 12px;
    line-height: 1.2;
  }

  .video-section--small .video-heading { font-size: 1.5rem; }
  .video-section--medium .video-heading { font-size: 2rem; }
  .video-section--large .video-heading { font-size: 2.5rem; }

  .video-subheading {
    font-size: 1.1rem;
    color: var(--neutral-600);
    line-height: 1.6;
  }

  .video-wrapper {
    position: relative;
    aspect-ratio: 16/9;
    border-radius: 16px;
    overflow: hidden;
    background: var(--neutral-900);
  }

  .video-section--fullscreen .video-wrapper {
    border-radius: 0;
  }

  .video-iframe {
    width: 100%;
    height: 100%;
  }

  .video-cover {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .video-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--neutral-500);
  }
</style>
