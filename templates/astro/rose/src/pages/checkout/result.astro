---
import data from '../../data/data.json';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

const meta = data?.meta ?? {};
---
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Результат оплаты — {meta?.title ?? 'Мой магазин'}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
      :root {
        --rose-50: #fff1f2;
        --rose-100: #ffe4e6;
        --rose-600: #e11d48;
        --rose-700: #be123c;
        --neutral-50: #fafafa;
        --neutral-500: #737373;
        --neutral-600: #525252;
        --neutral-800: #262626;
        --font-display: 'Cormorant Garamond', Georgia, serif;
        --font-body: 'Inter', system-ui, -apple-system, sans-serif;
      }

      * { box-sizing: border-box; margin: 0; padding: 0; }

      body {
        font-family: var(--font-body);
        color: var(--neutral-800);
        background: var(--neutral-50);
        line-height: 1.6;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      h1, h2 {
        font-family: var(--font-display);
        font-weight: 500;
        letter-spacing: -0.02em;
      }

      .result-container {
        flex: 1;
        max-width: 600px;
        margin: 0 auto;
        padding: 60px 20px 80px;
        width: 100%;
        text-align: center;
      }

      .result-section {
        display: none;
      }

      .result-section.active {
        display: block;
      }

      .result-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 24px;
      }

      .result-icon.success {
        color: #10b981;
      }

      .result-icon.error {
        color: #dc2626;
      }

      .result-icon.pending {
        color: #f59e0b;
      }

      .result-title {
        font-size: 2rem;
        margin-bottom: 16px;
        color: var(--neutral-800);
      }

      .result-text {
        font-size: 1.1rem;
        color: var(--neutral-600);
        margin-bottom: 32px;
      }

      .order-number {
        display: inline-block;
        background: var(--rose-50);
        padding: 12px 24px;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 500;
        color: var(--rose-600);
        margin-bottom: 32px;
      }

      .btn-primary {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 16px 32px;
        font-size: 1rem;
        font-weight: 500;
        font-family: inherit;
        background: var(--rose-600);
        color: #fff;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: background 0.2s;
        text-decoration: none;
      }

      .btn-primary:hover {
        background: var(--rose-700);
        color: #fff;
      }

      .loading-spinner {
        width: 48px;
        height: 48px;
        border: 3px solid var(--neutral-200);
        border-radius: 50%;
        border-top-color: var(--rose-600);
        animation: spin 0.8s linear infinite;
        margin: 0 auto 24px;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      .loading-text {
        color: var(--neutral-500);
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <Header siteName={meta?.title ?? 'ROSE'} />

    <main class="result-container">
      <!-- Загрузка -->
      <div class="result-section active" id="result-loading">
        <div class="loading-spinner"></div>
        <p class="loading-text">Проверяем статус оплаты...</p>
      </div>

      <!-- Успех -->
      <div class="result-section" id="result-success">
        <svg class="result-icon success" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
        <h1 class="result-title">Спасибо за заказ!</h1>
        <p class="result-text">Ваш заказ успешно оплачен. Мы отправим подтверждение на вашу почту.</p>
        <div class="order-number" id="order-number"></div>
        <br><br>
        <a href="/" class="btn-primary">Вернуться в магазин</a>
      </div>

      <!-- Ожидание -->
      <div class="result-section" id="result-pending">
        <svg class="result-icon pending" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        <h1 class="result-title">Платёж обрабатывается</h1>
        <p class="result-text">Ваш платёж ещё обрабатывается. Мы отправим уведомление, когда оплата будет подтверждена.</p>
        <a href="/" class="btn-primary">Вернуться в магазин</a>
      </div>

      <!-- Ошибка -->
      <div class="result-section" id="result-failed">
        <svg class="result-icon error" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <line x1="15" y1="9" x2="9" y2="15"/>
          <line x1="9" y1="9" x2="15" y2="15"/>
        </svg>
        <h1 class="result-title">Оплата не прошла</h1>
        <p class="result-text" id="error-message">К сожалению, платёж не был завершён. Попробуйте ещё раз.</p>
        <a href="/" class="btn-primary">Вернуться в магазин</a>
      </div>
    </main>

    <Footer siteName={meta?.title ?? 'ROSE'} />

    <!-- Конфигурация Merfy -->
    <script is:inline define:vars={{ apiUrl: meta?.apiUrl }}>
      window.__MERFY_CONFIG__ = {
        apiUrl: apiUrl || 'https://api.merfy.ru',
      };
    </script>
    <script type="module" src="/scripts/checkout-result.js"></script>
  </body>
</html>
