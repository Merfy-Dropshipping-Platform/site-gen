---
import SectionHeader from './shared/SectionHeader.astro';
import ProductCardItem from './shared/ProductCardItem.astro';

interface Props {
  heading?: any;
  text?: any;
  productCard?: { columns?: number; buttonStyle?: string; cardStyle?: string; nextPhoto?: string; quickAdd?: string };
  padding?: { top?: number; bottom?: number };
  dataSource?: string;
  collection?: string;
  cards?: number;
  colorScheme?: string;
}

const {
  heading = { text: 'Коллекция товаров', size: 'small' },
  text = { content: 'Текст', size: 'small' },
  productCard = { columns: 4 },
  padding = { top: 80, bottom: 80 },
  dataSource = 'auto',
  cards,
} = Astro.props;

const headingText = typeof heading === 'object' ? heading?.text : heading;
const textContent = typeof text === 'object' ? text?.content : text;
const columns = productCard?.columns || 4;

let products: Array<{ id?: string; name: string; price: string; oldPrice: string; image: string; href?: string }> = [];
try {
  const productsData = await import('../data/products.json');
  products = productsData.default || [];
} catch {
  products = [
    { name: 'Товар', price: '5 990₽', oldPrice: '7 990₽', image: '/images/popular-1.png' },
    { name: 'Товар', price: '5 990₽', oldPrice: '7 990₽', image: '/images/popular-2.png' },
    { name: 'Товар', price: '5 990₽', oldPrice: '7 990₽', image: '/images/popular-3.png' },
    { name: 'Товар', price: '5 990₽', oldPrice: '7 990₽', image: '/images/popular-4.png' },
  ];
}
---

<section id="popular" class="bg-white w-full scroll-mt-20" style={`padding: ${padding?.top || 80}px 0 ${padding?.bottom || 80}px;`}>
  <div class="w-full max-w-[1920px] mx-auto px-4 sm:px-6 md:px-8 lg:px-12 xl:px-16 2xl:px-[300px]">
    <SectionHeader title={headingText || ''} subtitle={textContent} />

    <div class="grid product-grid-dynamic gap-4 sm:gap-5 md:gap-6 xl:gap-[16px]">
      {(cards ? products.slice(0, cards) : products).map((product) => (
        <ProductCardItem
          id={product.id}
          name={product.name}
          price={product.price}
          oldPrice={product.oldPrice}
          image={product.image}
          href={product.href}
        />
      ))}
    </div>
  </div>
</section>

<style define:vars={{ cols: columns }}>
  .product-grid-dynamic {
    grid-template-columns: repeat(1, 1fr);
  }
  @media (min-width: 640px) {
    .product-grid-dynamic {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  @media (min-width: 1024px) {
    .product-grid-dynamic {
      grid-template-columns: repeat(var(--cols), 1fr);
    }
  }
</style>
