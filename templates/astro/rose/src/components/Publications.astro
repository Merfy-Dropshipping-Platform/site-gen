---
interface Post {
  image?: string;
  title?: string;
  description?: string;
  link?: { enabled?: string; text?: string; href?: string };
  hidden?: boolean;
}

interface Props {
  heading?: { enabled?: string; text?: string; size?: 'small' | 'medium' | 'large' };
  posts?: Post[];
  columnsCount?: number;
  dateTime?: { enabled?: string };
  colorScheme?: string;
  padding?: { top?: number; bottom?: number };
}

const { heading, posts = [], columnsCount = 3, padding } = Astro.props;
const showHeading = heading?.enabled !== 'false' && heading?.text;
const headingSize = heading?.size ?? 'medium';
const padTop = padding?.top ?? 80;
const padBottom = padding?.bottom ?? 80;
const visiblePosts = posts.filter((p) => !p.hidden);
---

<section class={`publications publications--${headingSize}`} style={`padding-top: ${padTop}px; padding-bottom: ${padBottom}px;`}>
  <div class="publications-container">
    {showHeading && <h2 class="publications-heading">{heading!.text}</h2>}

    {visiblePosts.length === 0 ? (
      <p class="publications-empty">Публикации скоро появятся</p>
    ) : (
      <div class="publications-grid" style={`--columns: ${columnsCount}`}>
        {visiblePosts.map((post) => (
          <article class="publication-card">
            {post.image && (
              <div class="publication-image">
                <img src={post.image} alt={post.title ?? ''} loading="lazy" />
              </div>
            )}
            <div class="publication-content">
              {post.title && <h3 class="publication-title">{post.title}</h3>}
              {post.description && <p class="publication-description">{post.description}</p>}
              {post.link?.enabled !== 'false' && post.link?.href && (
                <a href={post.link.href} class="publication-link">{post.link.text ?? 'Читать далее'}</a>
              )}
            </div>
          </article>
        ))}
      </div>
    )}
  </div>
</section>

<style>
  .publications {
    max-width: 1200px;
    margin: 0 auto;
    padding-left: 20px;
    padding-right: 20px;
  }

  .publications-heading {
    font-family: var(--font-display);
    font-weight: 500;
    color: var(--neutral-900);
    text-align: center;
    margin-bottom: 48px;
    line-height: 1.2;
  }

  .publications--small .publications-heading { font-size: 1.5rem; }
  .publications--medium .publications-heading { font-size: 2rem; }
  .publications--large .publications-heading { font-size: 2.5rem; }

  .publications-empty {
    text-align: center;
    color: var(--neutral-500);
    font-size: 1.1rem;
    padding: 40px 0;
  }

  .publications-grid {
    display: grid;
    grid-template-columns: repeat(var(--columns), 1fr);
    gap: 32px;
  }

  @media (max-width: 768px) {
    .publications-grid { grid-template-columns: repeat(2, 1fr); gap: 24px; }
  }

  @media (max-width: 480px) {
    .publications-grid { grid-template-columns: 1fr; }
  }

  .publication-card {
    background: #fff;
    border-radius: 16px;
    overflow: hidden;
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .publication-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 16px 32px rgba(0, 0, 0, 0.08);
  }

  .publication-image {
    aspect-ratio: 16/9;
    overflow: hidden;
    background: var(--rose-50);
  }

  .publication-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s;
  }

  .publication-card:hover .publication-image img {
    transform: scale(1.05);
  }

  .publication-content {
    padding: 20px;
  }

  .publication-title {
    font-family: var(--font-display);
    font-size: 1.15rem;
    font-weight: 500;
    color: var(--neutral-900);
    margin-bottom: 8px;
    line-height: 1.3;
  }

  .publication-description {
    font-size: 0.95rem;
    color: var(--neutral-600);
    line-height: 1.6;
    margin-bottom: 12px;
  }

  .publication-link {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--rose-600);
    text-decoration: none;
    transition: color 0.2s;
  }

  .publication-link:hover {
    color: var(--rose-700);
  }
</style>
