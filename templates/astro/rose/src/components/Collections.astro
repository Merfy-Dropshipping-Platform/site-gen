---
import SectionHeader from './shared/SectionHeader.astro';
import CollectionCardItem from './shared/CollectionCardItem.astro';

interface Props {
  title?: string;
  subtitle?: string;
  titleSize?: string;
  subtitleSize?: string;
  dataSource?: string;
  collections?: Array<{ name: string; image: string }>;
  columnsCount?: number;
  colorScheme?: string;
  padding?: { top?: number; bottom?: number };
}

const {
  title = 'Снова в продаже',
  subtitle = 'Стиль для каждой ситуации - найдите свой в каталоге.',
  dataSource = 'auto',
  collections = [],
  columnsCount = 3,
  padding = { top: 80, bottom: 80 },
} = Astro.props;

let collectionsData = collections || [];

if (dataSource === 'auto' || collectionsData.length === 0) {
  try {
    const imported = await import('../data/collections.json');
    collectionsData = imported.default || [];
  } catch {
    collectionsData = [
      { name: 'Коллекция 1', image: '/images/puk-1.png' },
      { name: 'Коллекция 2', image: '/images/puk-2.png' },
      { name: 'Коллекция 3', image: '/images/puk-3.png' },
    ];
  }
}

const cols = columnsCount || 3;
---

<section id="collections" class="bg-white w-full scroll-mt-16 sm:scroll-mt-20" style={`padding: ${padding?.top || 80}px 0 ${padding?.bottom || 80}px;`}>
  <div class="w-full max-w-7xl mx-auto px-4 sm:px-6 md:px-8 lg:px-10 xl:px-12">
    <SectionHeader title={title || ''} subtitle={subtitle} />

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 sm:gap-8 md:gap-10 lg:gap-12 xl:gap-16 collections-grid" role="list">
      {collectionsData.map((collection, index) => (
        <CollectionCardItem
          name={collection.name}
          image={collection.image}
          eager={index < 2}
        />
      ))}
    </div>
  </div>
</section>

<style define:vars={{ cols }}>
  @media (min-width: 1024px) {
    .collections-grid {
      grid-template-columns: repeat(var(--cols), minmax(0, 1fr));
    }
  }
</style>
